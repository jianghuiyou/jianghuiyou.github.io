<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="本科毕业于北邮，如今在清华计算机系苦念研究生，喜欢技术，热爱生活、运动、音乐，永远奋斗着的fighter">
<meta property="og:type" content="website">
<meta property="og:title" content="惠友">
<meta property="og:url" content="http://www.jianghuiyou.com/page/2/index.html">
<meta property="og:site_name" content="惠友">
<meta property="og:description" content="本科毕业于北邮，如今在清华计算机系苦念研究生，喜欢技术，热爱生活、运动、音乐，永远奋斗着的fighter">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="惠友">
<meta name="twitter:description" content="本科毕业于北邮，如今在清华计算机系苦念研究生，喜欢技术，热爱生活、运动、音乐，永远奋斗着的fighter">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.jianghuiyou.com/page/2/"/>





  <title>惠友</title>
  <script type="text/javascript">
    var host = "jianghuiyou.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">惠友</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">记录成长的点滴</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-essay">
          <a href="/categories/随笔/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br />
            
            随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/categories/阅读/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            阅读
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tech">
          <a href="/categories/技术/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-rocket"></i> <br />
            
            技术
          </a>
        </li>
      
        
        <li class="menu-item menu-item-product">
          <a href="/categories/产品/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-eye"></i> <br />
            
            产品
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/10/21/并发世界的探索（一）————互斥锁、自旋锁、条件变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/21/并发世界的探索（一）————互斥锁、自旋锁、条件变量/" itemprop="url">
                  并发世界的探索（一）————互斥锁、自旋锁、条件变量
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-21T16:51:22+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/21/并发世界的探索（一）————互斥锁、自旋锁、条件变量/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/21/并发世界的探索（一）————互斥锁、自旋锁、条件变量/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>计算机通过操作系统对进程调度的管理在单核系统中也能实现并发，而只有多核系统中才存在真正的并行操作，两者的区别可以理解为并发是在一段时间内有多个程序在运行，而并行是在一个时间点上依然有多个程序在运行。下面主要结合C++介绍常用的多线程并发技术以及对其的理解。</p>
<h2 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h2><p>在多线程共享同一资源的情况下，会存在着多线程同时操作共享资源带来的不确定性，也称为同步竞争～比如我们都知道的例子，共享变量<code>i++</code>在汇编层面并不是原子操作，若一个线程在其中某一步被其他线程打断之后就会存在变量操作异常。这个时候就需要对这个共享资源进行加锁，C++中的std::mutex就是最常见的互斥锁，unlock和lock操作必须由同一线程来完成，也就是解铃还须系铃人，这样在lock与unlock之间就形成了临界区（同一时刻只能由一个线程进入）。可有时候某个线程万一在lock之后发生异常退出就会导致其他线程饿死，所以更加安全管理mutex的方式是通过运用RAII思想的<code>std::lock_guard</code>和<code>std::unique_lock</code>来进行管理，上锁之后在该作用域生命周期结束后会自动解锁，如下使用方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">std::mutex mtx;</div><div class="line">try &#123;</div><div class="line">    std::unique_lock&lt;std::mutex&gt; lock(mtx);</div><div class="line">    // do something may have exception</div><div class="line">&#125; catch() &#123;</div><div class="line">    std::cerr &lt;&lt; &quot;oops! exception!&quot; &lt;&lt; std::endl;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/21/并发世界的探索（一）————互斥锁、自旋锁、条件变量/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/09/19/探秘计算机内存管理（二）———segmentation-fault/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/19/探秘计算机内存管理（二）———segmentation-fault/" itemprop="url">
                  探秘计算机内存管理（二）———segmentation fault
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-19T19:49:21+08:00">
                2017-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/19/探秘计算机内存管理（二）———segmentation-fault/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/19/探秘计算机内存管理（二）———segmentation-fault/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>刚开始接触C/C++编程时候总会遇到segmentation fault段错误，虽然现在看来这是一个相对容易调试的问题，但一直只知道是访问非法地址造成的，如今在拜读《深入理解计算机系统》虚拟内存那章，才明白其中的本质原理。</p>
<p>上节我们提到所有的计算机程序内存首先映射到虚拟地址空间，然后通过TLB或者页表机制来进行从虚拟地址到物理地址的翻译，整个虚拟地址空间分成多个区域，包括代码段.text、数据段.data .bss、堆、共享库、栈等等，而操作系统内核为每个进程维护一个<code>task_struct</code>,这其中的一个结构<code>mm_struct</code>记录了当前虚拟内存的状态，其中的<code>pgd</code>为一级页表的基址，<code>mmap</code>指向这些区域信息的结构体组成的链表，其中的每一个结构体<code>vm_area_struct</code>表示的就是某个区域的起止地址等信息，见下图所示。<br><img src="http://oa576fej8.bkt.clouddn.com/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98.jpeg" alt="此处输入图片的描述"><br>当进程在第一次访问某虚拟地址时，因其并未存在于真实物理内存当中，所以会触发一个缺页中断，然后控制流转移到内核的缺页中断处理程序，在进行地址翻译那些过程之前首先要做的就是验证该虚拟地址的合法性。简单来讲，就是将该虚拟地址与链表中的每一个<code>vm_area_struct</code>的<code>vm_end</code>和<code>vm_start</code>作比较，如果不在这些合法区域之中，就会触发我们常见的segmentation fault段错误，当然实际linux系统中为了加快链表遍历速度会结合使用树等高级数据结构。</p>
<p>这就更深入地解释了程序进行非法地址访问的时候会产生段错误的原因，比如下面这小段代码通常会引发段错误<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> i = <span class="number">100</span>;</div><div class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, i);</div></pre></td></tr></table></figure></p>
<p>这是因为<code>scanf</code>函数第二个参数传入理应是一个地址，这里将100这个整数当成一个地址值传入函数中，通常这个地址是不在<code>vm_area_struct</code>合法区域中从而引发段错误；可如果这个地址恰恰是合法区域的虚拟地址，那就可能产生莫名其妙的运行错误，将一个scanf输入的整数值覆盖到进程某个地址上，这调试起来才更加困难。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/09/07/探秘计算机内存管理（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/07/探秘计算机内存管理（一）/" itemprop="url">
                  探秘计算机内存管理（一）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-07T22:18:13+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/07/探秘计算机内存管理（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/07/探秘计算机内存管理（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>对于软件开发中一个常见的<code>i++</code>代码，也许我们知道编译成汇编指令是先将内存中的数据MOV到CPU中的某个寄存器，然后再执行自增INC。可是这个程序从加载到内存，并从内存读数据到CPU，这背后操作系统掩盖了非常多的细节与秘密，作为软件开发者还需掌握这隐藏的内存管理原理。首先，需要介绍几个重要的概念。</p>
<h4 id="1-虚拟内存"><a href="#1-虚拟内存" class="headerlink" title="1. 虚拟内存"></a>1. 虚拟内存</h4><p>虚拟内存VM是操作系统内存管理中最重要的概念，进程运行中以及我们调试代码看到的地址都是虚拟地址，操作系统会通过MMU将虚拟地址翻译成物理地址，并保证程序访问和操作物理地址的安全性，当然真实地址翻译的过程更加复杂。此外，作为当物理内存不够用或者发生缺页异常的时候，虚拟内存还需要执行相应的换入换出以便让应用程序顺利、透明地访问想要的数据。</p>
<h4 id="2-虚拟地址空间"><a href="#2-虚拟地址空间" class="headerlink" title="2. 虚拟地址空间"></a>2. 虚拟地址空间</h4><p>所有的程序在运行的时都拥有一个私有的虚拟地址空间，其中包括代码段、数据段、堆、共享库、栈以及内核虚拟空间。x86_64 Linux虚拟地址空间结构图如下（来自《深入理解计算机系统》）<br><img src="http://oa576fej8.bkt.clouddn.com/%E8%BF%9B%E7%A8%8B%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.jpeg" alt="此处输入图片的描述"><br>这个虚拟空间并不真实存在于物理内存中，只按需才映射到真实的物理内存中。我们可以通过<code>ulimit -a</code>命令来查看用户态进程占用资源的限制。看到stack size代表用户栈的大小上限，address space代表虚拟地址空间的大小上限。</p>
<h4 id="3-存储层次结构"><a href="#3-存储层次结构" class="headerlink" title="3. 存储层次结构"></a>3. 存储层次结构</h4><p>现代存储系统已经发展出复杂的存储结构，本文提及的存储系统如下表。CPU寄存器是最快最昂贵的存储介质，针对32位或64位的数据进行处理，TLB（Translation Lookaside Buffer）是为了加快地址翻译产生的，从它可以直接获取得到真实的物理地址，而不需要访问内存中的页表进行地址翻译。至于L1、L2、L3这三层cache都是为了加快DRAM物理内存访问而产生的SRAM存储介质，64B是cache管理的最小存储单位，通常被叫做<code>cache line</code>，在Intel Core i7中三者的大小分别是32KB、256KB、8MB，并且L3是所有核心共享的。虚拟内存就是通过页表（通常4KB）为单位来管理内存,然后通过地址翻译来拿到真实物理地址。</p>
<table>
<thead>
<tr>
<th style="text-align:center">存储类型</th>
<th style="text-align:center">缓存内容</th>
<th style="text-align:center">平均延迟（周期）</th>
<th style="text-align:center">管理者</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CPU寄存器</td>
<td style="text-align:center">4字节/8字节</td>
<td style="text-align:center">0</td>
<td style="text-align:center">编译器</td>
</tr>
<tr>
<td style="text-align:center">TLB</td>
<td style="text-align:center">地址翻译</td>
<td style="text-align:center">0</td>
<td style="text-align:center">CPU中MMU</td>
</tr>
<tr>
<td style="text-align:center">L1高速缓存</td>
<td style="text-align:center">64字节</td>
<td style="text-align:center">4</td>
<td style="text-align:center">单核</td>
</tr>
<tr>
<td style="text-align:center">L2高速缓存</td>
<td style="text-align:center">64字节</td>
<td style="text-align:center">10</td>
<td style="text-align:center">单核</td>
</tr>
<tr>
<td style="text-align:center">L3高速缓存</td>
<td style="text-align:center">64字节</td>
<td style="text-align:center">50</td>
<td style="text-align:center">所有核</td>
</tr>
<tr>
<td style="text-align:center">虚拟内存</td>
<td style="text-align:center">通常4KB</td>
<td style="text-align:center">200</td>
<td style="text-align:center">硬件+OS</td>
</tr>
</tbody>
</table>
<p>介绍完这些概念，我们再来看看程序运行背后内存管理的秘密？</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/07/探秘计算机内存管理（一）/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/08/06/tcpcopy优化实战记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/06/tcpcopy优化实战记录/" itemprop="url">
                  tcpcopy优化实战记录
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-06T09:33:03+08:00">
                2017-08-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/06/tcpcopy优化实战记录/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/06/tcpcopy优化实战记录/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>tcpcopy是网易开发并开源的一款tcp流量复制工具，可以在尽量不影响线上服务器的基础上，对其tcp流量进行复制或者放大用来进行线上仿真测试、压测等实验。github上有对其部署的介绍<a href="https://github.com/session-replay-tools/tcpcopy">https://github.com/session-replay-tools/tcpcopy</a> ，不喜欢英文的可以看看这个教程<a href="https://xnow.me/ops/simple-tcpcopy-use.html">https://xnow.me/ops/simple-tcpcopy-use.html</a> 。在此就不在赘述基础的部署流程～</p>
<p>可是因为tcpcopy依赖raw socket以及pcap进行抓包，一旦流量比较大就会出现大量的丢包情况，所以这篇文章主要是针对丢包问题进行优化。</p>
<h3 id="开启pcap模式并结合PF-RING"><a href="#开启pcap模式并结合PF-RING" class="headerlink" title="开启pcap模式并结合PF_RING"></a>开启pcap模式并结合PF_RING</h3><p>单独开启pcap模式很多场景下并不能获得更好的抓包能力，需要结合PF_RING效果才好～tcpcopy的官网对此一句带过，在此介绍详细配置过程。</p>
<ol>
<li>安装PF_RING内核模块,官方指明内核版本必须2.6.18以上<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/ntop/PF_RING.git</div><div class="line">cd PF_RING/kernel</div><div class="line">make</div><div class="line">sudo insmod ./pf_ring.ko</div><div class="line">cd ../userland</div><div class="line">make</div></pre></td></tr></table></figure>
</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/06/tcpcopy优化实战记录/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/07/27/读《穷查理宝典》有感/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/27/读《穷查理宝典》有感/" itemprop="url">
                  读《穷查理宝典》有感
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-27T22:11:40+08:00">
                2017-07-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阅读/" itemprop="url" rel="index">
                    <span itemprop="name">阅读</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/27/读《穷查理宝典》有感/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/27/读《穷查理宝典》有感/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近集中时间看完了在图书馆预约一个月才拿到的热门书籍《穷查理宝典》，这本书的名字借鉴了本杰明.富兰克林的《穷查理年鉴》一书，书中也多次表现出查理芒格对富兰克林的崇敬之意。查理芒格这个人向来较为低调，当然是相比于他鼎鼎大名的合伙人——沃伦.巴菲特而言，两个人联手创造了伯克希尔哈撒韦这个金融帝国。这本书主要集中了查理芒格一生中主要的智慧结晶，包括其观念、思考和决策方式以及几次精选的演讲，读过之后就仿佛和芒格隔空畅谈，颇受启发。横看层岭侧成峰，在此记录下自己看过之后印象最深的几点。</p>
<h3 id="多元思维模型"><a href="#多元思维模型" class="headerlink" title="多元思维模型"></a>多元思维模型</h3><p>多元思维模型是本书反复强调的一种观点，这是一种结合多种学科知识的基本原理和模型试图去解释生活中、商业中各种各样的现象，想一想还是很有挑战的。毕竟社会这个庞大繁杂的系统不可能被一般人所摸透，所以芒格强调不断地去学习不同学科领域的各种知识，不断改进自己的多元思维模型，以达到尽可能完美地去解释社会的种种，拥有所谓的普世智慧。在这里记录下本书重点提到的几种领域知识：</p>
<ol>
<li>数学、物理等理工类硬科学，很多本来为了应付考试的知识其实蕴涵着大道理，其中包括不限于：排列组合原理、费马帕斯卡系统、质量控制理论、后备系统、断裂点理论、物理学临界质量概念、决策树理论、基本概率论，作为理工科生自己表示有不少也没听说过，还需要多多学习啊。</li>
<li>心理学，芒格故意批判了很多高校讲授的心理学课程，并表示大部分心理学教材并没有提到一些很重要的心理学模型，本书重点讲述误判心理学，这个点会在下面详述。</li>
<li>会计学，从事商业活动必须要懂的基础知识，能通过分析财务三大报表来了解一个公司的经营状况。</li>
<li>微观经济学，芒格并不看好过于学术派的经济学，不过还是肯定了经济学中一些常见的模型，比如机会成本、边际成本、复利原理、规模效应等等。<br>毕竟，“在只拿着锤子的人眼中，世界上所有的问题都像是一颗钉子”，这句话发人深思。</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/07/27/读《穷查理宝典》有感/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/06/12/深入浅出Unix系统级IO（上）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/12/深入浅出Unix系统级IO（上）/" itemprop="url">
                  深入浅出Unix系统级IO（上）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-12T23:28:59+08:00">
                2017-06-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/12/深入浅出Unix系统级IO（上）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/06/12/深入浅出Unix系统级IO（上）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>该文章为阅读CSAPP系统级IO篇章之后的总结，记录下一些基础概念和理解，但并不会逐一介绍每一个系统级IO函数的使用方法。I/O即input/output在计算机中通常表示从IO设备读数据到内存以及从内存写数据到IO设备，这里的IO设备既可以是磁盘、网卡，也可以是打印机、显示屏、键盘等。那系统级IO又是Unix操作系统位用户态应用程序提供的<strong>系统调用API</strong>，但我们通常用C语言编程使用的是在系统IO上封装的更加高级的<strong>标准IO库</strong>以及在网络编程中使用的为了防止漏读漏写问题更加健壮的<strong>RIO自定义接口</strong>。</p>
<p><img src="http://oa576fej8.bkt.clouddn.com/%E7%B3%BB%E7%BB%9F%E7%BA%A7IO.jpeg" alt="此处输入图片的描述"></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/06/12/深入浅出Unix系统级IO（上）/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/05/17/投资之道讲座记录————陈小红、王强/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/投资之道讲座记录————陈小红、王强/" itemprop="url">
                  投资之道讲座记录————陈小红、王强
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T22:58:16+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/17/投资之道讲座记录————陈小红、王强/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/17/投资之道讲座记录————陈小红、王强/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天有幸参加经管学院组织的一场叫做“投资之道”的讲座，请到了两位在中国投资领域很知名的两位投资人～一个是真格基金的联合创始人王强，另一个是号称“投资女王”的陈小红。王强我们可能都比较熟悉，是新东方三名合伙人的其中之一，现场的感受不愧是讲课出身，口才卓越，掌握全场节奏又非常诙谐幽默。陈小红名气虽然不大为人低调，但她个个投资的项目都最终成为行业龙头老大，比如新东方、学而思、京东、滴滴等等，投资的成果十分惊人，“投资女王”的称号实至名归。在这里主要记录下自己本次讲座最大的体会和收获，先附上现成图片一张～<br><img src="http://oa576fej8.bkt.clouddn.com/20170517.jpeg" alt="此处输入图片的描述"></p>
<h3 id="独立思考"><a href="#独立思考" class="headerlink" title="独立思考"></a>独立思考</h3><p>陈小红女士提到自己对公司实习生要求的时候提到了一个关于独立思考的能力，现在想想这种能力确实是绝大部分人所欠缺，包括从小习惯填鸭式教学擅长考试的自己，很多道理大家貌似都懂，很多客观事实大家貌似也都听到看到，但是又有多少人能去调研分析思考这些现象背后隐藏的本质？比如，自己超爱神盾局特工美剧也是一个漫威粉丝，但自己并没有思考过为何早早存在的漫威宇宙漫画在这十几年里发展迅猛博得大量的眼球；机器学习、神经网络这些技术在这些年飞速发展并商业化，仅仅是因为计算量和数据量的提升吗？等等这种就发生在自己身边的客观事实和趋势，我们并没有真正去调研思考它背后的原因。</p>
<p>王强老师说到自己在看一本书的时候发现书中的一个问题，自己会立马合上书籍去思考问题的答案，如果这本书给出的答案和自己想的如出一辙，那么可以考虑放弃阅读这本level和自己差不多的书。以后自己会努力成为一名更主动去思考的人，也会在自己的博客里不定期加入关于自己思考分析的文章。</p>
<h3 id="对人性的考量"><a href="#对人性的考量" class="headerlink" title="对人性的考量"></a>对人性的考量</h3><p>王强老师在谈论当年为何不看好可穿戴设备的时候，先幽默地调侃了可穿戴这个名字的缺点（哈哈，也可不穿戴），然后提到了自己完全基于对人性的思考，人往往回家之后会穿得越少越放松越好，很少有人会愿意到家之后还耳朵别一个、胸口贴一个、大腿根夹一个这种十分不便的选择，所以可穿戴设备经过多年的炒作并没有产生独角兽公司，确实一个成功产品最终归根于对人性的把握。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/05/15/深入理解计算机的链接知识（下）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/15/深入理解计算机的链接知识（下）/" itemprop="url">
                  深入浅出计算机链接（下）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-15T14:56:36+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/15/深入理解计算机的链接知识（下）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/15/深入理解计算机的链接知识（下）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>上一次我们已经说过在linux/unix系统中整个编译、链接以及链接过程中的符号解析和重定位，这一次将重点介绍静态链接库和动态链接库，以及这两种技术出现的原因和各自的优缺点。</p>
<h3 id="静态链接库"><a href="#静态链接库" class="headerlink" title="静态链接库"></a>静态链接库</h3><p>如果现在手头的大型项目里有非常多的模块函数，该如何将他们合理地链接入最后的可执行文件呢？</p>
<p>第一种常见的做法就是将功能类似的函数全部都放到一个可重定位目标文件中，这样每一个<code>.o</code>文件含有大量的目标函数，自然也会比较占用空间。因为一旦引用一个函数，便会将还有该函数的<code>.o</code>文件合并到可执行文件中进而存放到磁盘上，这必然带来磁盘空间的浪费；更为致命的是，一旦同样或带有同样功能模块的程序加载到内存中，每一个程序都含有该<code>.o</code>文件的副本，这也大大浪费内存空间；此外，对于模块函数稍稍的改变，需要开发人员重新编译整个源文件，维护起来也十分不方便。</p>
<p>第二种做法就是每一个函数都单独存放在一个<code>.o</code>可执行目标文件里，而用文件路径进行这些函数功能的组织，比如<code>a1.o</code>和<code>a2.o</code>都放在<code>~/project/a/</code>目录下。这样磁盘和内存的浪费可以避免，但是在编译链接整个库函数的时候却十分冗杂，因为你需要手动将整个项目所有引用的库函数一个一个引进来，想想简直是噩梦。<br><code>$ gcc main.c ~/project/a/a1.o ~/project/a/a2.o ~/project/b/b1.o ......</code></p>
<p>结合上面两种做法同时为了解决上面出现的问题，静态库这种技术自然就诞生了～模块函数可以单独编译汇编成独立的可重定位目标文件<code>.o</code>，然后根据大类将大量的’.o’打包封装成为一个单独的静态库文件<code>.a</code>，而在链接的时候linker仅仅将程序引用的目标模版合并到最终的可执行文件中。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/15/深入理解计算机的链接知识（下）/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/05/06/深入理解计算机的链接知识（上）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/06/深入理解计算机的链接知识（上）/" itemprop="url">
                  深入浅出计算机链接（上）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-06T21:29:17+08:00">
                2017-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/06/深入理解计算机的链接知识（上）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/06/深入理解计算机的链接知识（上）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本篇文章是在阅读CSAPP（深入理解计算机系统）这本经典著作第七章链接之后的概要记录，大家有空的话还是建议去阅读原书链接这章，如果想做到真正地深入理解计算机链接，还需要去阅读《编译原理》原书，并尝试去实现自己的编译器、链接器。</p>
<p>链接其实像是拼图，将各个子图拼凑在一起，最终生成一个完整清晰的大图，也就是可执行目标文件，最终这个文件可以被加载器加载到内存中，从而其中的代码可以得到执行来实现想要的功能。那么一个源代码文本文件是最终如何变成一个可执行目标文件的呢？这里我们以GNU编译系统，也就是我们常用的gcc操作c语言，具体的过程如下图。<br><img src="http://oa576fej8.bkt.clouddn.com/%E7%BC%96%E8%AF%91.jpeg" alt="过程详情"><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/06/深入理解计算机的链接知识（上）/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.jianghuiyou.com/2017/04/23/HTTP长连接如何判断数据传输结束/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="惠友">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="惠友">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/23/HTTP长连接如何判断数据传输结束/" itemprop="url">
                  HTTP长连接如何判断数据传输结束
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-23T23:36:30+08:00">
                2017-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/23/HTTP长连接如何判断数据传输结束/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/23/HTTP长连接如何判断数据传输结束/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近在流量分析项目中，针对http数据由于keepalive的存在，如果根据TCP状态机进入CLOSE才判断数据结束，会存在着较大的延迟，在linux系统中抓包实测大概会有60秒左右TCP的持续延迟，这就大大妨碍系统分析数据的时效性。为了解决这个问题，自己对HTTP长连接进行研究并实现了数据提前抽取的实时性功能。</p>
<p>KeepAlive属于HTTP头部Connection字段，即<code>Connection: KeepAlive</code>。它是在HTTP1.0版本中引入，并在HTTP1.1中默认配置的属性，现在大多主流的浏览器都已经是HTTP1.1，引入KeepAlive的主要目的就是<strong>降低web应用中http传输延迟和带宽</strong>。</p>
<p>传统的HTTP0.9版本（已废弃）和没有进行keepalive设置的1.0版本，当进行一次HTTP的请求响应的数据等信息的传输都需要建立一个TCP Connection，也就是要走三次握手、四次挥手并严格遵从TCP拥塞控制机制，一旦数据输出完TCP会立即关闭，而如果再次进行数据传输还需要再次建立TCP Connection，这样引入KeepAlive机制的优势就不言而喻。KeepAlive确实很棒，但在项目实时性需求下又成了麻烦之处，还好HTTP丰富的头部信息为我们解决这个问题带来了帮助。</p>
<p>HTTP数据传输主要分成两种模式，一种是通过Content-Length，另外一种是通过Transfer-Encoding: chunked，这两种各有千秋。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/23/HTTP长连接如何判断数据传输结束/#post.more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://oa576fej8.bkt.clouddn.com/%E6%88%91.jpeg"
               alt="惠友" />
          <p class="site-author-name" itemprop="name">惠友</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jianghuiyou" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/%E6%83%A0%E5%8F%8B-%E5%A7%9C-3b3631105?trk=nav_responsive_tab_profile_pic" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">惠友</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://huiyou.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
